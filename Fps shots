<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
<title>FPS 3D</title>
<style>
body{margin:0;overflow:hidden;background:#000;font-family:Arial}
#menu,#gameover{
position:fixed;inset:0;
display:flex;flex-direction:column;
justify-content:center;align-items:center;
background:#000;color:#fff;z-index:20
}
button{
padding:15px 30px;font-size:22px;
border:none;border-radius:10px;
background:#0f0;color:#000
}
#hud,#cross,.joy{display:none}
#hud{position:fixed;top:10px;left:10px;color:#fff;z-index:10}
#cross{
position:fixed;top:50%;left:50%;
width:20px;height:20px;margin:-10px;
border:2px solid #fff;z-index:10
}
.joy{
position:fixed;bottom:20px;
width:120px;height:120px;
border-radius:50%;
background:rgba(255,255,255,0.15);
z-index:10
}
#move{left:20px}
#fire{right:20px;display:flex;justify-content:center;align-items:center;font-size:30px}
</style>
</head>
<body>

<div id="menu">
<h1>FPS 3D</h1>
<button id="startBtn">–ò–≥—Ä–∞—Ç—å</button>
</div>

<div id="gameover" style="display:none">
<h1>GAME OVER</h1>
<button onclick="location.reload()">–ó–∞–Ω–æ–≤–æ</button>
</div>

<div id="hud">‚ù§Ô∏è 100 | üëæ 0</div>
<div id="cross"></div>
<div class="joy" id="move"></div>
<div class="joy" id="fire">üî´</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
<script>
let scene,camera,renderer,started=false;
let hp=100,score=0;
let enemies=[],keys={},yaw=0;

const hud=document.getElementById("hud");
const cross=document.getElementById("cross");
const move=document.getElementById("move");
const fire=document.getElementById("fire");

document.getElementById("startBtn").onclick=()=>{
document.getElementById("menu").style.display="none";
hud.style.display=cross.style.display=move.style.display=fire.style.display="block";
startGame();
};

function startGame(){
started=true;
init();
animate();
}

function init(){
scene=new THREE.Scene();
scene.background=new THREE.Color(0x202020);

camera=new THREE.PerspectiveCamera(75,innerWidth/innerHeight,0.1,1000);
camera.position.set(0,2,5);

renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
document.body.appendChild(renderer.domElement);

// —Å–≤–µ—Ç
scene.add(new THREE.AmbientLight(0x555555));
let sun=new THREE.DirectionalLight(0xffffff,1);
sun.position.set(5,10,5);
scene.add(sun);

// –ø–æ–ª
let floor=new THREE.Mesh(
new THREE.BoxGeometry(100,1,100),
new THREE.MeshStandardMaterial({color:0x333333})
);
floor.position.y=-1;
scene.add(floor);

// –≤—Ä–∞–≥–∏
for(let i=0;i<5;i++)spawnEnemy();
}

function spawnEnemy(){
let e=new THREE.Mesh(
new THREE.BoxGeometry(1,2,1),
new THREE.MeshStandardMaterial({color:0xff0000})
);
e.position.set(Math.random()*20-10,1,Math.random()*-30);
scene.add(e);
enemies.push(e);
}

function updateHUD(){
hud.innerHTML=`‚ù§Ô∏è ${hp} | üëæ ${score}`;
}

function shoot(){
if(!started)return;
let ray=new THREE.Raycaster();
ray.setFromCamera(new THREE.Vector2(0,0),camera);
let hit=ray.intersectObjects(enemies);
if(hit.length){
let o=hit[0].object;
scene.remove(o);
enemies.splice(enemies.indexOf(o),1);
score++;
spawnEnemy();
updateHUD();
}
}

// —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
document.addEventListener("keydown",e=>keys[e.code]=true);
document.addEventListener("keyup",e=>keys[e.code]=false);
document.addEventListener("mousemove",e=>{
if(started) yaw-=e.movementX*0.002;
});
document.addEventListener("click",shoot);
fire.addEventListener("touchstart",shoot);

function animate(){
if(!started)return;
requestAnimationFrame(animate);

camera.rotation.y=yaw;
let s=0.15;
if(keys.KeyW)camera.translateZ(-s);
if(keys.KeyS)camera.translateZ(s);
if(keys.KeyA)camera.translateX(-s);
if(keys.KeyD)camera.translateX(s);

enemies.forEach(e=>{
e.lookAt(camera.position);
e.translateZ(0.05);
if(e.position.distanceTo(camera.position)<1.5){
hp--;
updateHUD();
if(hp<=0){
document.getElementById("gameover").style.display="flex";
started=false;
}
}
});

renderer.render(scene,camera);
}

addEventListener("resize",()=>{
if(!camera)return;
camera.aspect=innerWidth/innerHeight;
camera.updateProjectionMatrix();
renderer.setSize(innerWidth,innerHeight);
});
</script>
</body>
</html>
